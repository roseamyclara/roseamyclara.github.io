<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>學校分機查詢</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="icon" href="https://cutewallpaper.org/24/search-icon-png/256513759.jpg">
  <link rel="shortcut icon" href="a198cd0c_e2f0_4c99_ba51_342624a24db9_WP4_icon.ico" type="image/x-icon"/>
  <style>
    /* 保留原有的樣式 */
    /* ... */

    /* 為科目篩選按鈕添加新的樣式 */
    .subject-filter {
      background-color: #f0f0f0;
      border: 1px solid #ddd;
      padding: 5px 10px;
      margin: 5px;
      cursor: pointer;
      border-radius: 5px;
    }

    .subject-filter.active {
      background-color: #4CAF50;
      color: white;
    }
  </style>
</head>      
<body>
  <!-- 密碼提示框和內容區域保持不變 -->
  <!-- ... -->

  <div id="content" class="container">
    <h1>分機號碼查詢 <span class="beta-tag">beta</span></h1>
    
    <input type="text" id="artInput" onkeyup="artFunction()" placeholder="職稱, 姓名, 辦公室,分機..." title="Work">

    <div class="filter-links">
      <a href="#" onclick="filterByRange([[1, 16], [131, 146]])">行政</a>
      <a href="#" onclick="filterByRange([[17, 70]])">導師</a>
      <a href="#" onclick="filterByRange([[71, 109]])">專任</a>
      <a href="#" onclick="filterByRange([[110, 130]])">代理&短代</a>
    </div>

    <div id="subjectFilters" class="filter-links">
      <!-- 科目篩選按鈕將在這裡動態生成 -->
    </div>

    <div class="table-responsive">
      <table id="artTable">
        <thead>
          <tr class="header">
            <th>編號</th>
            <th>職稱/班級</th>
            <th>姓名</th>
            <th class="hide-mobile">科目</th>
            <th class="hide-mobile">分機</th>
            <th>辦公室/廣播指令</th>
            <th>手機</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  
  <script>
    var attemptCount = 0;
    var originalData = []; // 用於存儲原始數據
    var currentFilter = null; // 用於跟踪當前的篩選狀態

    // 保留原有的 checkPassword 和相關的事件監聽器
    // ...

    function artFunction() {
      var input = document.getElementById('artInput');
      var filter = input.value.toUpperCase();
      var table = document.getElementById('artTable');
      var trs = table.tBodies[0].getElementsByTagName('tr');

      filterAndUpdateTable(trs, function(tr) {
        var tds = tr.getElementsByTagName('td');
        for (var i = 0; i < tds.length; i++) {
          if (tds[i].textContent.toUpperCase().indexOf(filter) > -1) {
            return true;
          }
        }
        return false;
      });
    }

    function filterByRange(ranges) {
      var table = document.getElementById('artTable');
      var trs = table.tBodies[0].getElementsByTagName('tr');

      filterAndUpdateTable(trs, function(tr) {
        var numberCell = tr.getElementsByTagName('td')[0];
        var number = parseInt(numberCell.textContent);
        return ranges.some(range => number >= range[0] && number <= range[1]);
      });
    }

    function filterBySubject(subject) {
      var table = document.getElementById('artTable');
      var trs = table.tBodies[0].getElementsByTagName('tr');

      if (currentFilter === subject) {
        // 如果當前篩選器已經激活，則清除篩選
        currentFilter = null;
        filterAndUpdateTable(trs, function() { return true; });
        document.querySelectorAll('.subject-filter').forEach(btn => btn.classList.remove('active'));
      } else {
        // 否則，應用新的篩選
        currentFilter = subject;
        filterAndUpdateTable(trs, function(tr) {
          var subjectCell = tr.getElementsByTagName('td')[3];
          return subjectCell.textContent === subject;
        });
        document.querySelectorAll('.subject-filter').forEach(btn => {
          btn.classList.toggle('active', btn.textContent === subject);
        });
      }
    }

    function filterAndUpdateTable(trs, filterFunction) {
      var visibleCount = 0;
      for (var i = 0; i < trs.length; i++) {
        var shouldDisplay = filterFunction(trs[i]);
        trs[i].style.display = shouldDisplay ? '' : 'none';
        if (shouldDisplay) {
          visibleCount++;
          var numberCell = trs[i].getElementsByTagName('td')[0];
          numberCell.textContent = visibleCount; // 更新編號
          trs[i].classList.toggle('even', visibleCount % 2 === 0);
          trs[i].classList.toggle('odd', visibleCount % 2 !== 0);
        }
      }
    }

    function createSubjectFilters(data) {
      var subjects = [...new Set(data.map(item => item['科目']))];
      var filterContainer = document.getElementById('subjectFilters');
      subjects.forEach(subject => {
        if (subject) { // 只為非空的科目創建按鈕
          var button = document.createElement('button');
          button.textContent = subject;
          button.className = 'subject-filter';
          button.onclick = function() { filterBySubject(subject); };
          filterContainer.appendChild(button);
        }
      });
    }

    fetch('csvjson.json')
      .then(function(response) {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(function(data) {
        originalData = data; // 保存原始數據
        var table = document.getElementById('artTable');
        var tbody = table.querySelector('tbody');
        data.forEach(function(item, index) {
          var row = document.createElement('tr');
          row.classList.add(index % 2 === 0 ? 'even' : 'odd');
          
          var cellsToCreate = [
            index + 1, // 初始編號
            item['職稱/班級'], 
            item['姓名'], 
            item['科目'], 
            item['分機'], 
            item['辦公室/廣播指令'], 
            item['手機']
          ];

          cellsToCreate.forEach((cellContent, cellIndex) => {
            var cell = document.createElement('td');
            cell.textContent = cellContent;
            if (cellIndex === 3 || cellIndex === 4) {
              cell.classList.add('hide-mobile');
            }
            row.appendChild(cell);
          });

          tbody.appendChild(row);
        });

        createSubjectFilters(data);
      })
      .catch(function(error) {
        console.log('Error:', error.message);
      });
  </script>
</body>
</html>
